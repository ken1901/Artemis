<div *ngIf="!shouldHidePreview || (programmingExercise.title && programmingExercise.shortName)">
    <div class="form-group mt-2 mb-0">
        <label class="label-narrow" jhiTranslate="artemisApp.programmingExercise.preview.label" for="preview"></label>
        <jhi-help-icon text="artemisApp.programmingExercise.preview.tooltip"></jhi-help-icon>
    </div>
    <jhi-programming-exercise-plans-and-repositories-preview [programmingExercise]="programmingExercise"></jhi-programming-exercise-plans-and-repositories-preview>
    <div *ngIf="!isImportFromExistingExercise && auxiliaryRepositoriesSupported" class="form-group">
        <ngx-datatable
            id="auxiliaryRepositoryTable"
            class="bootstrap"
            trackByProp="id"
            [headerHeight]="50"
            [limit]="20"
            [columnMode]="'force'"
            [rowHeight]="'auto'"
            [rows]="programmingExercise.auxiliaryRepositories"
            *ngIf="programmingExercise.auxiliaryRepositories && programmingExercise.auxiliaryRepositories.length > 0"
        >
            <ngx-datatable-column name="Repository Name" prop="repositoryName">
                <ng-template ngx-datatable-cell-template let-row="row">
                    <jhi-table-editable-field
                        [id]="row.id + '-repositoryName'"
                        [value]="row.name || ''"
                        [onValueUpdate]="infrastructureInputs.updateRepositoryName(row)"
                        [pattern]="infrastructureInputs.invalidRepositoryNamePattern"
                        [isRequired]="true"
                        [translationBase]="'artemisApp.programmingExercise.auxiliaryRepository.repositoryNameRequired'"
                    >
                    </jhi-table-editable-field>
                </ng-template>
            </ngx-datatable-column>
            <ngx-datatable-column name="Checkout Directory" prop="checkoutDirectory">
                <ng-template ngx-datatable-cell-template let-row="row">
                    <jhi-table-editable-field
                        [id]="row.id + '-checkoutDirectory'"
                        [value]="row.checkoutDirectory || ''"
                        [onValueUpdate]="infrastructureInputs.updateCheckoutDirectory(row)"
                        [pattern]="infrastructureInputs.invalidDirectoryNamePattern"
                        [translationBase]="'artemisApp.programmingExercise.auxiliaryRepository.invalidDirectoryName'"
                    >
                    </jhi-table-editable-field>
                </ng-template>
            </ngx-datatable-column>
            <ngx-datatable-column name="Description" prop="description">
                <ng-template ngx-datatable-cell-template let-row="row">
                    <textarea class="form-control table-editable-field__input me-2" [id]="row.id + '-description'" [(ngModel)]="row.description" name="description"> </textarea>
                </ng-template>
            </ngx-datatable-column>
            <ngx-datatable-column name="" prop="removeButton">
                <ng-template ngx-datatable-cell-template let-row="row">
                    <jhi-remove-auxiliary-repository-button
                        placement="right auto"
                        [programmingExercise]="programmingExercise"
                        (onRefresh)="infrastructureInputs.refreshAuxiliaryRepositoryChecks()"
                        [row]="row"
                        class="ml-2"
                    ></jhi-remove-auxiliary-repository-button>
                </ng-template>
            </ngx-datatable-column>
        </ngx-datatable>
        <ngb-alert
            [dismissible]="false"
            [type]="'danger'"
            *ngIf="infrastructureInputs.auxiliaryRepositoryDuplicateNames || infrastructureInputs.auxiliaryRepositoryDuplicateDirectories"
        >
            <span *ngIf="infrastructureInputs.auxiliaryRepositoryDuplicateNames">{{
                'artemisApp.programmingExercise.auxiliaryRepository.duplicateRepositoryNames' | artemisTranslate
            }}</span>
            <span *ngIf="infrastructureInputs.auxiliaryRepositoryDuplicateDirectories">{{
                'artemisApp.programmingExercise.auxiliaryRepository.duplicateDirectoryNames' | artemisTranslate
            }}</span>
        </ngb-alert>
        <ngb-alert [dismissible]="false" [type]="'info'" *ngIf="isEdit">
            <span>{{ 'artemisApp.programmingExercise.auxiliaryRepository.warning' | artemisTranslate }}</span>
        </ngb-alert>
        <jhi-add-auxiliary-repository-button
            [programmingExercise]="programmingExercise"
            (onRefresh)="infrastructureInputs.refreshAuxiliaryRepositoryChecks()"
            class="ml-2"
        ></jhi-add-auxiliary-repository-button>
    </div>
</div>

<!-- It would be very complicated to change the sequential test run feature after an exercise is created, which is why it can only be activated if the exercise was not yet created.-->
<div class="form-group mb-0" *ngIf="sequentialTestRunsAllowed">
    <div class="form-check">
        <label class="form-check-label" for="field_sequentialTestRuns">
            <input
                class="form-check-input"
                type="checkbox"
                name="sequentialTestRuns"
                id="field_sequentialTestRuns"
                [disabled]="!!programmingExercise.id || !!programmingExercise.staticCodeAnalysisEnabled || !!programmingExercise.testwiseCoverageEnabled"
                [(ngModel)]="programmingExercise.sequentialTestRuns"
                checked
            />
            <span jhiTranslate="artemisApp.programmingExercise.sequentialTestRuns.title">Differentiate Test Case Execution</span>
            <jhi-help-icon placement="auto" text="artemisApp.programmingExercise.sequentialTestRuns.description"></jhi-help-icon>
        </label>
    </div>
</div>

<!-- Setting whether the solution repository should be checked out is only supported for Haskell exercises and is only available for new exercises -->
<div class="form-group mb-0" *ngIf="!programmingExercise.id && programmingExercise.programmingLanguage && checkoutSolutionRepositoryAllowed">
    <div class="form-check">
        <label class="form-check-label" for="field_checkoutSolutionRepository">
            <input
                class="form-check-input"
                type="checkbox"
                name="checkoutSolutionRepository"
                id="field_checkoutSolutionRepository"
                [(ngModel)]="programmingExercise.checkoutSolutionRepository"
            />
            <span jhiTranslate="artemisApp.programmingExercise.checkoutSolutionRepository.title">Checkout Solution repository</span>
            <jhi-help-icon placement="auto" text="artemisApp.programmingExercise.checkoutSolutionRepository.description"></jhi-help-icon>
        </label>
    </div>
</div>

<div class="form-group mb-0">
    <div class="form-check">
        <label [class]="!validIdeSelection() ? 'form-check-label text-danger' : 'form-check-label'" for="field_allowOfflineIde">
            <input class="form-check-input" type="checkbox" name="allowOfflineIde" id="field_allowOfflineIde" [(ngModel)]="programmingExercise.allowOfflineIde" checked />
            <span jhiTranslate="artemisApp.programmingExercise.allowOfflineIde.title">Allow Offline IDE</span>
            <fa-icon
                *ngIf="!validIdeSelection()"
                [icon]="faQuestionCircle"
                class="text-danger"
                [placement]="'top'"
                ngbTooltip="{{ 'artemisApp.programmingExercise.allowOfflineIde.alert' | artemisTranslate }}"
            ></fa-icon>
        </label>
    </div>
</div>

<div class="form-group mb-0" *ngIf="ProjectType.XCODE !== selectedProjectType">
    <div class="form-check">
        <label [class]="!validIdeSelection() ? 'form-check-label text-danger' : 'form-check-label'" for="field_allowOnlineEditor">
            <input class="form-check-input" type="checkbox" name="allowOnlineEditor" id="field_allowOnlineEditor" [(ngModel)]="programmingExercise.allowOnlineEditor" checked />
            <span jhiTranslate="artemisApp.programmingExercise.allowOnlineEditor.title">Allow Online Editor</span>
            <fa-icon
                *ngIf="!validIdeSelection()"
                [icon]="faQuestionCircle"
                class="text-danger"
                [placement]="'top'"
                ngbTooltip="{{ 'artemisApp.programmingExercise.allowOnlineEditor.alert' | artemisTranslate }}"
            ></fa-icon>
        </label>
    </div>
</div>

<div class="form-group mb-0">
    <div class="form-check">
        <label class="form-check-label" for="field_showTestNamesToStudents">
            <input
                class="form-check-input"
                type="checkbox"
                name="showTestNamesToStudents"
                id="field_showTestNamesToStudents"
                [(ngModel)]="programmingExercise.showTestNamesToStudents"
                checked
            />
            <span jhiTranslate="artemisApp.programmingExercise.showTestNamesToStudents">Show Test Names to Students</span>
            <fa-icon
                [icon]="faQuestionCircle"
                class="text-secondary"
                placement="auto"
                ngbTooltip="{{ 'artemisApp.programmingExercise.showTestNamesToStudentsTooltip' | artemisTranslate }}"
            ></fa-icon>
        </label>
    </div>
</div>

<div class="form-group mb-0" *ngIf="publishBuildPlanUrlAllowed">
    <div class="form-check">
        <label class="form-check-label" for="field_publishBuildPlanUrl">
            <input
                class="form-check-input"
                type="checkbox"
                name="publishBuildPlanUrl"
                id="field_publishBuildPlanUrl"
                [(ngModel)]="programmingExercise.publishBuildPlanUrl"
                checked
            />
            <span jhiTranslate="artemisApp.programmingExercise.publishBuildPlanUrl">Publish Build Plan Url</span>
        </label>
    </div>
</div>

<div class="form-group mb-0" *ngIf="testwiseCoverageAnalysisSupported">
    <div class="form-check">
        <label class="form-check-label" for="field_testwiseCoverageEnabled">
            <input
                class="form-check-input"
                type="checkbox"
                name="testwiseCoverageEnabled"
                id="field_testwiseCoverageEnabled"
                [disabled]="!!programmingExercise.sequentialTestRuns || !!programmingExercise.id"
                [(ngModel)]="programmingExercise.testwiseCoverageEnabled"
                checked
            />
            <span jhiTranslate="artemisApp.programmingExercise.recordTestwiseCoverage">Record Testwise Coverage</span>
            <fa-icon
                [icon]="faQuestionCircle"
                class="text-secondary"
                placement="auto"
                ngbTooltip="{{ 'artemisApp.programmingExercise.recordTestwiseCoverageTooltip' | artemisTranslate }}"
            ></fa-icon>
        </label>
    </div>
</div>

<div *ngIf="isImportFromExistingExercise" class="form-group mb-0">
    <div class="form-check">
        <label class="form-check-label" for="field_recreateBuildPlans">
            <input
                class="form-check-input"
                type="checkbox"
                name="recreateBuildPlans"
                id="field_recreateBuildPlans"
                [(ngModel)]="recreateBuildPlans"
                (change)="recreateBuildPlanOrUpdateTemplateChange()"
            />
            <span jhiTranslate="artemisApp.programmingExercise.recreateBuildPlans.title">Recreate Build Plans</span>
            <jhi-help-icon placement="auto" text="artemisApp.programmingExercise.recreateBuildPlans.description"></jhi-help-icon>
        </label>
    </div>
</div>

<div
    class="form-group mb-0"
    *ngIf="isImportFromExistingExercise && programmingExercise.projectType !== ProjectType.PLAIN_GRADLE && programmingExercise.projectType !== ProjectType.GRADLE_GRADLE"
>
    <div class="form-check">
        <label class="form-check-label" for="field_updateTemplateFiles">
            <input
                class="form-check-input"
                type="checkbox"
                name="updateTemplateFiles"
                id="field_updateTemplateFiles"
                [(ngModel)]="updateTemplate"
                (change)="recreateBuildPlanOrUpdateTemplateChange()"
            />
            <span jhiTranslate="artemisApp.programmingExercise.updateTemplate.title">Update template</span>
            <jhi-help-icon placement="auto" text="artemisApp.programmingExercise.updateTemplate.description"></jhi-help-icon>
        </label>
    </div>
</div>
